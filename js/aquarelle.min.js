/*
Aquarelle, The creative & opensource CSS framework.
Copyright (C) 2012 Floris MORICEAU <floris.moriceau@komuneco.org> and Guillaume AMAT <guillaume.amat@komuneco.org>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/

(function(b){function a(c){if(b(c).has(":focus").length>0){b(c).addClass("child-has-focus").find(":focus").one("blur",function(){setTimeout(function(){a(c)},100)})}else{b(c).removeClass("child-has-focus")}}b(document).ready(function(){b(document).on("change",".input-file > input[type=file].real-input-file",function(){b(this).parent().find(".fake-input-file > input[type=text]").val(this.value)});b(document).on("mouseleave",".hover-dropdown-list ul, .focus-dropdown-list ul, .dropdown-top-menu ul, .dropdown-side-menu ul",function(){a(this)});b(document).on("click",".focus-dropdown-list > :button",function(){b(this).focus()});b.fn.powerTip.defaults.smartPlacement=true;b(".tooltip-n").powerTip({placement:"n"});b(".tooltip-ne").powerTip({placement:"ne"});b(".tooltip-e").powerTip({placement:"e"});b(".tooltip-se").powerTip({placement:"se"});b(".tooltip-s").powerTip({placement:"s"});b(".tooltip-sw").powerTip({placement:"sw"});b(".tooltip-w").powerTip({placement:"w"});b(".tooltip-nw").powerTip({placement:"nw"})})})(jQuery);var i,html5_elements=["address","article","aside","audio","canvas","command","datalist","details","dialog","figure","figcaption","footer","header","hgroup","keygen","mark","meter","menu","nav","progress","ruby","section","time","video"];for(i in html5_elements){document.createElement(html5_elements[i])}i=html5_elements=undefined;(function(f){var d=f(document),c=f(window),e=f("body");var m={isTipOpen:false,isFixedTipOpen:false,isClosing:false,tipOpenImminent:false,activeHover:null,currentX:0,currentY:0,previousX:0,previousY:0,desyncTimeout:null,mouseTrackingActive:false};f.fn.powerTip=function(o){if(!this.length){return this}var w=f.extend({},f.fn.powerTip.defaults,o),p=new k(w);a();this.each(function v(){var z=f(this),y=z.data("powertip"),x=z.data("powertipjq"),B=z.data("powertiptarget"),A=z.attr("title");if(!y&&!B&&!x&&A){z.data("powertip",A).removeAttr("title")}z.data("displayController",new j(z,w,p))});this.on({mouseenter:function s(x){g(x);m.previousX=x.pageX;m.previousY=x.pageY;f(this).data("displayController").show()},mouseleave:function u(){f(this).data("displayController").hide()},focus:function t(){f(this).data("displayController").show(true)},blur:function q(){f(this).data("displayController").hide(true)},keydown:function r(x){if(x.keyCode===27){f(this).data("displayController").hide(true)}}});return this};f.fn.powerTip.defaults={fadeInTime:200,fadeOutTime:100,followMouse:false,popupId:"powerTip",intentSensitivity:7,intentPollInterval:100,closeDelay:100,placement:"n",smartPlacement:false,offset:10,mouseOnToPopup:false};f.fn.powerTip.smartPlacementLists={n:["n","ne","nw","s"],e:["e","ne","se","w","nw","sw","n","s","e"],s:["s","se","sw","n"],w:["w","nw","sw","e","ne","se","n","s","w"],nw:["nw","w","sw","n","s","se","nw"],ne:["ne","e","se","n","s","sw","ne"],sw:["sw","w","nw","s","n","ne","sw"],se:["se","e","ne","s","n","nw","se"]};f.powerTip={showTip:function h(o){o=o.first();o.data("displayController").show(true,true)},closeTip:function b(){d.triggerHandler("closePowerTip")}};function j(r,q,v){var o=null;function p(x,y){s();if(!r.data("hasActiveHover")){if(!x){m.tipOpenImminent=true;o=setTimeout(function w(){o=null;t(r)},q.intentPollInterval)}else{if(y){r.data("forcedOpen",true)}v.showTip(r)}}}function u(x){s();m.tipOpenImminent=false;if(r.data("hasActiveHover")){r.data("forcedOpen",false);if(!x){o=setTimeout(function w(){o=null;v.hideTip(r)},q.closeDelay)}else{v.hideTip(r)}}}function t(){var y=Math.abs(m.previousX-m.currentX),w=Math.abs(m.previousY-m.currentY),x=y+w;if(x<q.intentSensitivity){v.showTip(r)}else{m.previousX=m.currentX;m.previousY=m.currentY;p()}}function s(){o=clearTimeout(o)}return{show:p,hide:u,cancel:s}}function k(A){var y=f("#"+A.popupId);if(y.length===0){y=f("<div/>",{id:A.popupId});if(e.length===0){e=f("body")}e.append(y)}if(A.followMouse){if(!y.data("hasMouseMove")){d.on({mousemove:w,scroll:w});y.data("hasMouseMove",true)}}if(A.mouseOnToPopup){y.on({mouseenter:function v(){if(y.data("mouseOnToPopup")){if(m.activeHover){m.activeHover.data("displayController").cancel()}}},mouseleave:function x(){if(m.activeHover){m.activeHover.data("displayController").hide()}}})}function s(C){C.data("hasActiveHover",true);y.queue(function B(D){r(C);D()})}function r(D){if(!D.data("hasActiveHover")){return}if(m.isTipOpen){if(!m.isClosing){u(m.activeHover)}y.delay(100).queue(function C(J){r(D);J()});return}D.trigger("powerTipPreRender");var B=D.data("powertip"),G=D.data("powertiptarget"),I=D.data("powertipjq"),F=G?f("#"+G):[];if(B){y.html(B)}else{if(I&&I.length>0){y.empty();I.clone(true,true).appendTo(y)}else{if(F&&F.length>0){y.html(f("#"+G).html())}else{return}}}D.trigger("powerTipRender");d.on("closePowerTip",function H(){D.data("displayController").hide(true)});m.activeHover=D;m.isTipOpen=true;y.data("followMouse",A.followMouse);y.data("mouseOnToPopup",A.mouseOnToPopup);if(!A.followMouse){q(D);m.isFixedTipOpen=true}else{w()}y.fadeIn(A.fadeInTime,function E(){if(!m.desyncTimeout){m.desyncTimeout=setInterval(t,500)}D.trigger("powerTipOpen")})}function u(B){m.isClosing=true;B.data("hasActiveHover",false);B.data("forcedOpen",false);m.activeHover=null;m.isTipOpen=false;m.desyncTimeout=clearInterval(m.desyncTimeout);d.off("closePowerTip");y.fadeOut(A.fadeOutTime,function C(){m.isClosing=false;m.isFixedTipOpen=false;y.removeClass();p(m.currentX+A.offset,m.currentY+A.offset);B.trigger("powerTipClose")})}function t(){if(m.isTipOpen&&!m.isClosing){var B=false;if(m.activeHover.data("hasActiveHover")===false||m.activeHover.is(":disabled")){B=true}else{if(!n(m.activeHover)&&!m.activeHover.is(":focus")&&!m.activeHover.data("forcedOpen")){if(y.data("mouseOnToPopup")){if(!n(y)){B=true}}else{B=true}}}if(B){u(m.activeHover)}}}function w(){if((m.isTipOpen&&!m.isFixedTipOpen)||(m.tipOpenImminent&&!m.isFixedTipOpen&&y.data("hasMouseMove"))){var C=y.outerWidth(),F=y.outerHeight(),B=m.currentX+A.offset,G=m.currentY+A.offset,D=l({left:B,top:G},C,F),E=D.length;if(E>0){if(E===1){if(D[0]==="right"){B=c.width()-C}else{if(D[0]==="bottom"){G=c.scrollTop()+c.height()-F}}}else{B=m.currentX-C-A.offset;G=m.currentY-F-A.offset}}p(B,G)}}function q(C){var B,D;if(A.smartPlacement){B=f.fn.powerTip.smartPlacementLists[A.placement];f.each(B,function(E,G){var F=l(o(C,G),y.outerWidth(),y.outerHeight());D=G;if(F.length===0){return false}})}else{o(C,A.placement);D=A.placement}y.addClass(D)}function o(E,D){var B=0,C,G,F;p(0,0);do{C=y.outerWidth();G=y.outerHeight();F=z(E,D,C,G);y.css(F)}while(++B<=5&&(C!==y.outerWidth()||G!==y.outerHeight()));return F}function z(G,F,H,B){var I=G.offset(),D=G.outerWidth(),C=G.outerHeight(),E="auto",J="auto",K="auto";switch(F){case"n":E=Math.round((I.left+(D/2))-(H/2));J=Math.round(I.top-B-A.offset);break;case"e":E=Math.round(I.left+D+A.offset);J=Math.round((I.top+(C/2))-(B/2));break;case"s":E=Math.round((I.left+(D/2))-(H/2));J=Math.round(I.top+C+A.offset);break;case"w":J=Math.round((I.top+(C/2))-(B/2));K=Math.round(c.width()-I.left+A.offset);break;case"nw":J=Math.round(I.top-B-A.offset);K=Math.round(c.width()-I.left-20);break;case"ne":E=Math.round((I.left+D)-20);J=Math.round(I.top-B-A.offset);break;case"sw":J=Math.round(I.top+C+A.offset);K=Math.round(c.width()-I.left-20);break;case"se":E=Math.round((I.left+D)-20);J=Math.round(I.top+C+A.offset);break}return{left:E,top:J,right:K}}function p(B,C){y.css({left:B+"px",top:C+"px",right:"auto"})}return{showTip:s,hideTip:u}}function a(){var p=0,o=0;if(!m.mouseTrackingActive){m.mouseTrackingActive=true;f(function r(){p=d.scrollLeft();o=d.scrollTop()});d.on({mousemove:g,scroll:function q(){var s=d.scrollLeft(),t=d.scrollTop();if(s!==p){m.currentX+=s-p;p=s}if(t!==o){m.currentY+=t-o;o=t}}})}}function g(o){m.currentX=o.pageX;m.currentY=o.pageY}function n(o){var p=o.offset();return m.currentX>=p.left&&m.currentX<=p.left+o.outerWidth()&&m.currentY>=p.top&&m.currentY<=p.top+o.outerHeight()}function l(s,r,q){var u=c.scrollLeft(),t=c.scrollTop(),p=c.width(),v=c.height(),o=[];if(s.top<t){o.push("top")}if(s.top+q>t+v){o.push("bottom")}if(s.left<u||s.right+r>u+p){o.push("left")}if(s.left+r>u+p||s.right<u){o.push("right")}return o}}(jQuery));