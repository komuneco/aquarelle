/*
Aquarelle, The creative & opensource CSS framework.
Copyright (C) 2012 Floris MORICEAU <floris.moriceau@komuneco.org> and Guillaume AMAT <guillaume.amat@komuneco.org>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/

(function(c){function a(e){if(c(e).has(":focus").length>0){c(e).addClass("child-has-focus").find(":focus").one("blur",function(){setTimeout(function(){a(e)},100)})}else{c(e).removeClass("child-has-focus")}}function d(f,g,e){var h=c(f).attr("title");if(typeof(h)!="undefined"){if(h!=c(f).data("powertip")){c(f).data("powertip",h)}c(f).removeAttr("title")}c(f).powerTip({manual:true,placement:e});return c(f).powerTip("show",g)}function b(e){return c(e).powerTip("hide")}c(document).ready(function(){c(document).on("change",".input-file > input[type=file].real-input-file",function(){c(this).parent().find(".fake-input-file > input[type=text]").val(this.value)});c(document).on("mouseleave",".hover-dropdown-list ul, .focus-dropdown-list ul, .dropdown-top-menu ul, .dropdown-side-menu ul",function(){a(this)});c(document).on("click",".focus-dropdown-list > :button",function(){c(this).focus()});c.fn.powerTip.defaults.smartPlacement=true;c(document).on("mouseenter",".tooltip-n",function(e){d(this,e,"n")}).on("mouseenter",".tooltip-ne",function(e){d(this,e,"ne")}).on("mouseenter",".tooltip-ne-alt",function(e){d(this,e,"ne-alt")}).on("mouseenter",".tooltip-e",function(e){d(this,e,"e")}).on("mouseenter",".tooltip-se",function(e){d(this,e,"se")}).on("mouseenter",".tooltip-se-alt",function(e){d(this,e,"se-alt")}).on("mouseenter",".tooltip-s",function(e){d(this,e,"s")}).on("mouseenter",".tooltip-sw",function(e){d(this,e,"sw")}).on("mouseenter",".tooltip-sw-alt",function(e){d(this,e,"sw-alt")}).on("mouseenter",".tooltip-w",function(e){d(this,e,"w")}).on("mouseenter",".tooltip-nw",function(e){d(this,e,"nw")}).on("mouseenter",".tooltip-nw-alt",function(e){d(this,e,"nw-alt")}).on("mouseleave",".tooltip-n, .tooltip-ne, .tooltip-ne-alt, .tooltip-e, .tooltip-se, .tooltip-se-alt, .tooltip-s, .tooltip-sw, .tooltip-sw-alt, .tooltip-w, .tooltip-nw, .tooltip-nw-alt",function(){b(this)})})})(jQuery);var i,html5_elements=["address","article","aside","audio","canvas","command","datalist","details","dialog","figure","figcaption","footer","header","hgroup","keygen","mark","meter","menu","nav","progress","ruby","section","time","video"];for(i in html5_elements){document.createElement(html5_elements[i])}i=html5_elements=undefined;var $document=$(window.document),$window=$(window),$body=$("body"),RAD2DEG=180/Math.PI;var session={isTipOpen:false,isFixedTipOpen:false,isClosing:false,tipOpenImminent:false,activeHover:null,currentX:0,currentY:0,previousX:0,previousY:0,desyncTimeout:null,mouseTrackingActive:false};$.fn.powerTip=function(a,j){if(!this.length){return this}if(typeof a==="string"&&$.powerTip[a]){return $.powerTip[a].call(this,this,j)}var k=$.extend({},$.fn.powerTip.defaults,a),b=new TooltipController(k);initMouseTracking();this.each(function h(){var n=$(this),m=n.data("powertip"),l=n.data("powertipjq"),p=n.data("powertiptarget"),o=n.attr("title");if(n.data("displayController")){$.powerTip.destroy(n);o=n.attr("title")}if(!m&&!p&&!l&&o){n.data({powertip:o,originalTitle:o}).removeAttr("title")}n.data("displayController",new DisplayController(n,k,b))});if(!k.manual){this.on({"mouseenter.powertip":function e(l){elementShowAndTrack(this,l)},"mouseleave.powertip":function g(){elementHideTip(this)},"focus.powertip":function f(){elementShowTip(this,true)},"blur.powertip":function c(){elementHideTip(this,true)},"keydown.powertip":function d(l){if(l.keyCode===27){elementHideTip(this,true)}}})}return this};$.fn.powerTip.defaults={fadeInTime:200,fadeOutTime:100,followMouse:false,popupId:"powerTip",intentSensitivity:7,intentPollInterval:100,closeDelay:100,placement:"n",smartPlacement:false,offset:10,mouseOnToPopup:false,manual:false};$.fn.powerTip.smartPlacementLists={n:["n","ne","nw","s"],e:["e","ne","se","w","nw","sw","n","s","e"],s:["s","se","sw","n"],w:["w","nw","sw","e","ne","se","n","s","w"],nw:["nw","w","sw","n","s","se","nw"],ne:["ne","e","se","n","s","sw","ne"],sw:["sw","w","nw","s","n","ne","sw"],se:["se","e","ne","s","n","nw","se"],"nw-alt":["nw-alt","n","ne-alt","nw","ne","w","sw-alt","s","se-alt","sw","se","e"],"ne-alt":["ne-alt","n","nw-alt","ne","nw","e","se-alt","s","sw-alt","se","sw","w"],"sw-alt":["sw-alt","s","se-alt","sw","se","w","nw-alt","n","ne-alt","nw","ne","e"],"se-alt":["se-alt","s","sw-alt","se","sw","e","ne-alt","n","nw-alt","ne","nw","w"]};$.powerTip={showTip:function apiShowTip(a,b){if(b){elementShowAndTrack(a.first(),b)}else{elementShowTip(a.first(),true,true)}return a},resetPosition:function apiResetPosition(a){a.first().data("displayController").resetPosition();return a},closeTip:function apiCloseTip(b,a){if(b){elementHideTip(b.first(),a)}else{$document.triggerHandler("closePowerTip")}return b},destroy:function apiDestroy(b){return b.off(".powertip").each(function a(){var c=$(this);if(c.data("originalTitle")){c.attr("title",c.data("originalTitle"))}c.removeData(["originalTitle","displayController","hasActiveHover","forcedOpen"])})}};$.powerTip.show=$.powerTip.showTip;$.powerTip.hide=$.powerTip.closeTip;function elementShowTip(b,a,c){$(b).data("displayController").show(a,c)}function elementShowAndTrack(a,b){trackMouse(b);session.previousX=b.pageX;session.previousY=b.pageY;elementShowTip(a)}function elementHideTip(b,a){$(b).data("displayController").hide(a)}function DisplayController(f,j,a){var e=null;function g(l,m){h();if(!f.data("hasActiveHover")){if(!l){session.tipOpenImminent=true;e=setTimeout(function k(){e=null;d()},j.intentPollInterval)}else{if(m){f.data("forcedOpen",true)}a.showTip(f)}}}function b(l){h();session.tipOpenImminent=false;if(f.data("hasActiveHover")){f.data("forcedOpen",false);if(!l){e=setTimeout(function k(){e=null;a.hideTip(f)},j.closeDelay)}else{a.hideTip(f)}}}function d(){var m=Math.abs(session.previousX-session.currentX),k=Math.abs(session.previousY-session.currentY),l=m+k;if(l<j.intentSensitivity){a.showTip(f)}else{session.previousX=session.currentX;session.previousY=session.currentY;g()}}function h(){e=clearTimeout(e)}function c(){a.resetPosition(f)}this.show=g;this.hide=b;this.cancel=h;this.resetPosition=c}function TooltipController(q){var o=$("#"+q.popupId);if(o.length===0){o=$("<div/>",{id:q.popupId});if($body.length===0){$body=$("body")}$body.append(o)}if(q.followMouse){if(!o.data("hasMouseMove")){$document.on({mousemove:k,scroll:k});o.data("hasMouseMove",true)}}if(q.mouseOnToPopup){o.on({mouseenter:function h(){if(o.data("mouseOnToPopup")){if(session.activeHover){session.activeHover.data("displayController").cancel()}}},mouseleave:function n(){if(session.activeHover){session.activeHover.data("displayController").hide()}}})}function e(s){s.data("hasActiveHover",true);o.queue(function r(t){d(s);t()})}function d(s){var u;if(!s.data("hasActiveHover")){return}if(session.isTipOpen){if(!session.isClosing){g(session.activeHover)}o.delay(100).queue(function r(w){d(s);w()});return}s.trigger("powerTipPreRender");u=l(s);if(u){o.empty().append(u)}else{return}s.trigger("powerTipRender");$document.on("closePowerTip",function v(){s.data("displayController").hide(true)});session.activeHover=s;session.isTipOpen=true;o.data("followMouse",q.followMouse);o.data("mouseOnToPopup",q.mouseOnToPopup);if(!q.followMouse){c(s);session.isFixedTipOpen=true}else{k()}o.fadeIn(q.fadeInTime,function t(){if(!session.desyncTimeout){session.desyncTimeout=setInterval(f,500)}s.trigger("powerTipOpen")})}function g(r){session.isClosing=true;r.data("hasActiveHover",false);r.data("forcedOpen",false);session.activeHover=null;session.isTipOpen=false;session.desyncTimeout=clearInterval(session.desyncTimeout);$document.off("closePowerTip");o.fadeOut(q.fadeOutTime,function s(){session.isClosing=false;session.isFixedTipOpen=false;o.removeClass();b(session.currentX+q.offset,session.currentY+q.offset);r.trigger("powerTipClose")})}function f(){if(session.isTipOpen&&!session.isClosing){var r=false;if(session.activeHover.data("hasActiveHover")===false||session.activeHover.is(":disabled")){r=true}else{if(!isMouseOver(session.activeHover)&&!session.activeHover.is(":focus")&&!session.activeHover.data("forcedOpen")){if(o.data("mouseOnToPopup")){if(!isMouseOver(o)){r=true}}else{r=true}}}if(r){g(session.activeHover)}}}function k(){if((session.isTipOpen&&!session.isFixedTipOpen)||(session.tipOpenImminent&&!session.isFixedTipOpen&&o.data("hasMouseMove"))){var s=o.outerWidth(),v=o.outerHeight(),r=session.currentX+q.offset,w=session.currentY+q.offset,t=getViewportCollisions({left:r,top:w},s,v),u=t.length;if(u>0){if(u===1){if(t[0]==="right"){r=$window.width()-s}else{if(t[0]==="bottom"){w=$window.scrollTop()+$window.height()-v}}}else{r=session.currentX-s-q.offset;w=session.currentY-v-q.offset}}b(r,w)}}function c(s){var r,t;if(q.smartPlacement){r=$.fn.powerTip.smartPlacementLists[q.placement];$.each(r,function(u,w){var v=getViewportCollisions(a(s,w),o.outerWidth(),o.outerHeight());t=w;if(v.length===0){return false}})}else{a(s,q.placement);t=q.placement}o.addClass(t)}function a(u,t){var r=0,s,w,v;b(0,0);do{s=o.outerWidth();w=o.outerHeight();v=p(u,t,s,w);o.css(v)}while(++r<=5&&(s!==o.outerWidth()||w!==o.outerHeight()));return v}function m(t,s){var x=t.offset(),w=t.outerWidth(),r=t.outerHeight(),v,u;switch(s){case"n":v=x.left+w/2;u=x.top;break;case"e":v=x.left+w;u=x.top+r/2;break;case"s":v=x.left+w/2;u=x.top+r;break;case"w":v=x.left;u=x.top+r/2;break;case"nw":v=x.left;u=x.top;break;case"ne":v=x.left+w;u=x.top;break;case"sw":v=x.left;u=x.top+r;break;case"se":v=x.left+w;u=x.top+r;break}return{top:u,left:v}}function j(y,t){var C=y.closest("svg")[0],w=y[0],G=C.createSVGPoint(),u=w.getBBox(),F=w.getScreenCTM(),v=u.width/2,A=u.height/2,z=[],r=["nw","n","ne","e","se","s","sw","w"],E,H,B,D;function s(){z.push(G.matrixTransform(F))}G.x=u.x;G.y=u.y;s();G.x+=v;s();G.x+=v;s();G.y+=A;s();G.y+=A;s();G.x-=v;s();G.x-=v;s();G.y-=A;s();if(z[0].y!==z[1].y||z[0].x!==z[7].x){H=Math.atan2(F.b,F.a)*RAD2DEG;B=Math.ceil(((H%360)-22.5)/45);if(B<1){B+=8}while(B--){r.push(r.shift())}}for(D=0;D<z.length;D++){if(r[D]===t){E=z[D];break}}return{top:E.y+$window.scrollTop(),left:E.x+$window.scrollLeft()}}function p(u,t,x,r){var w=t.split("-")[0],s="auto",y="auto",z="auto",v;if(isSvgElement(u)){v=j(u,w)}else{v=m(u,w)}switch(t){case"n":s=~~(v.left-(x/2));y=~~(v.top-r-q.offset);break;case"e":s=~~(v.left+q.offset);y=~~(v.top-(r/2));break;case"s":s=~~(v.left-(x/2));y=~~(v.top+q.offset);break;case"w":y=~~(v.top-(r/2));z=~~($window.width()-v.left+q.offset);break;case"nw":y=~~(v.top-r-q.offset);z=~~($window.width()-v.left-20);break;case"nw-alt":s=~~v.left;y=~~(v.top-r-q.offset);break;case"ne":s=~~(v.left-20);y=~~(v.top-r-q.offset);break;case"ne-alt":y=~~(v.top-r-q.offset);z=~~($window.width()-v.left);break;case"sw":y=~~(v.top+q.offset);z=~~($window.width()-v.left-20);break;case"sw-alt":s=~~v.left;y=~~(v.top+q.offset);break;case"se":s=~~(v.left-20);y=~~(v.top+q.offset);break;case"se-alt":y=~~(v.top+q.offset);z=~~($window.width()-v.left);break}return{left:s,top:y,right:z}}function l(u){var s=u.data("powertip"),r=u.data("powertipjq"),w=u.data("powertiptarget"),v;if(s){if(typeof s==="function"){s=s.call(u[0])}v=s}else{if(r){if(typeof tipElem==="function"){r=r.call(u[0])}if(r.length>0){v=r.clone(true,true)}}else{if(w){var t=$("#"+w);if(t.length>0){v=$("#"+w).html()}}}}return v}function b(r,s){o.css({left:r+"px",top:s+"px",right:"auto"})}this.showTip=e;this.hideTip=g;this.resetPosition=c}function isSvgElement(a){return typeof window.SVGElement!=="undefined"&&a[0] instanceof window.SVGElement}function computeElementSize(a){var b=a[0],c=b.getBoundingClientRect();return{width:~~c.width,height:~~c.height}}function initMouseTracking(){var b=0,a=0;if(!session.mouseTrackingActive){session.mouseTrackingActive=true;$(function d(){b=$document.scrollLeft();a=$document.scrollTop()});$document.on({mousemove:trackMouse,scroll:function c(){var e=$document.scrollLeft(),f=$document.scrollTop();if(e!==b){session.currentX+=e-b;b=e}if(f!==a){session.currentY+=f-a;a=f}}})}}function trackMouse(a){session.currentX=a.pageX;session.currentY=a.pageY}function isMouseOver(b){var c=b.offset(),a=computeElementSize(b);return session.currentX>=c.left&&session.currentX<=c.left+a.width&&session.currentY>=c.top&&session.currentY<=c.top+a.height}function getViewportCollisions(e,d,c){var g=$window.scrollLeft(),f=$window.scrollTop(),b=$window.width(),h=$window.height(),a=[];if(e.top<f){a.push("top")}if(e.top+c>f+h){a.push("bottom")}if(e.left<g||e.right+d>g+b){a.push("left")}if(e.left+d>g+b||e.right<g){a.push("right")}return a};